#include  <msp430.h>
#include  <legacymsp430.h>

#include "nokiaLcd.h"

#define LED0 BIT0
#define LED1 BIT6

interrupt(TIMER0_A0_VECTOR) Timer_A(void) {

}

#define Testss_width 84
#define Testss_height 48
static unsigned char Testss_bits[] = {
   0x07, 0x54, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x05,
   0x54, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x07, 0x54,
   0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x0a, 0x00, 0x54, 0x05,
   0x00, 0x00, 0xfe, 0x7f, 0x00, 0x80, 0x02, 0x05, 0xff, 0x57, 0x05, 0x00,
   0x00, 0x02, 0x40, 0x00, 0x80, 0x02, 0x00, 0x00, 0x54, 0x05, 0x00, 0x00,
   0x02, 0x40, 0x00, 0x80, 0x02, 0x00, 0xff, 0x57, 0x05, 0x00, 0x00, 0x02,
   0x40, 0x00, 0x80, 0x02, 0x00, 0x00, 0x54, 0x05, 0x00, 0x00, 0x02, 0x40,
   0x00, 0x80, 0x02, 0x00, 0xff, 0x57, 0x05, 0x00, 0x00, 0x02, 0x40, 0x00,
   0x80, 0x02, 0x00, 0x00, 0x54, 0x05, 0x00, 0x00, 0x02, 0x40, 0x00, 0xe0,
   0x0f, 0x00, 0xff, 0xff, 0x0f, 0x00, 0x00, 0x02, 0x40, 0x00, 0x00, 0x01,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xff, 0xff, 0x07, 0x00, 0x01, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x20, 0x00, 0x00, 0x01, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x24, 0x24, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x74, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xfc, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x74, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x24, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
   0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0x28,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x26, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x11, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x0c, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x07, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x02,
   0x80, 0xfe, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00, 0xc0, 0x05, 0x40,
   0x03, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0xe0, 0x0b, 0xa0, 0x03,
   0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0xe0, 0x15, 0xd0, 0x03, 0x00,
   0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0xfc, 0x2e, 0xe8, 0x03, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x00, 0x00, 0xe2, 0x55, 0xf4, 0x03, 0x00, 0x00, 0x00,
   0x00, 0x20, 0x00, 0x00, 0xe2, 0xab, 0xea, 0x03, 0x00, 0x00, 0x00, 0x00,
   0x40, 0x00, 0x00, 0xe2, 0x55, 0xf5, 0x03, 0x00, 0x00, 0x00, 0x00, 0x40,
   0x00, 0x00, 0xe2, 0xae, 0xeb, 0x03, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,
   0x00, 0xe2, 0x55, 0xf5, 0x03, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00,
   0xfc, 0xab, 0xeb, 0x03, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0xe0,
   0x55, 0xf5, 0x03, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0xe0, 0xab,
   0xeb, 0x03, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x80, 0xc0, 0x01, 0xc1,
   0x03, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x40, 0x80, 0x00, 0x81, 0xff,
   0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x20, 0x40, 0x00, 0x01, 0x01, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x20, 0x00, 0x01, 0x02, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x08, 0x40, 0x00, 0x01, 0x04, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x0f, 0x04, 0x80, 0xf8, 0x3f, 0x02, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x0f, 0x02, 0x00, 0x05, 0x40, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x0f, 0x01, 0x00, 0x02, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f };



void revertBitAndLCDSend(unsigned char c) {
	/*
	 unsigned char res=0;
	 if(c&BIT0)
	 res|=BIT7;
	 if(c&BIT1)
	 res|=BIT6;
	 if(c&BIT2)
	 res|=BIT5;
	 if(c&BIT3)
	 res|=BIT4;
	 if(c&BIT4)
	 res|=BIT3;
	 if(c&BIT5)
	 res|=BIT2;
	 if(c&BIT6)
	 res|=BIT1;
	 if(c&BIT7)
	 res|=BIT0;

	 LCDSend(res,SEND_CHR);
	 */
	LCDSend(c, SEND_CHR);
}

int main(void) {
	WDTCTL = WDTPW + WDTHOLD; // Stop WDT
	//  P1DIR = 0xFF;

	P1DIR |= (SCE | SDIN | DC | SCK | RES);

	BCSCTL1 = CALBC1_1MHZ; // Set range
	DCOCTL = CALDCO_1MHZ; // Set DCO step + modulation

	BCSCTL2 = 0xF8;
	BCSCTL3 = LFXT1S_0 + XCAP_3;

	CCTL0 = CCIE;
	CCR0 = 0;
	TACCR0 = 0x3FF;
	TACTL = 0x0211;

	LCDInit();

	_BIS_SR(GIE);

	while (1) {

		/*
		 LCDString(0,0,"\x99\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x8b");
		 LCDString(0,1,"\x8aСаш! Еще раз\x8a");
		 LCDString(0,2,"\x8a  спасибо   \x8a");
		 LCDString(0,3,"\x8aза паяльник!\x8a");
		 LCDString(0,4,"\x8a \x80\x80\x81\x81\xac\xac\x81\x81\x80\x80 \x8a");
		 LCDString(0,5,"\x98\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x9d\x8c");
		 */

		int row = 0;
		int col = 0;
		char bitMov[] = { BIT0, BIT1, BIT2, BIT3, BIT4, BIT5, BIT6, BIT7 };
		int curBit = 0;
		for (row = 0; row < 6; row++) {
			LCDCurs(0, row);
			for (col = 0; col < 11; col++) {
				for (curBit = 0; curBit < 8; curBit++) {
					LCDSend(
							(((Testss_bits[88 * row + 0 * 11 + col]
									& bitMov[curBit]) ? BIT0 : 0)
									| ((Testss_bits[88 * row + 1 * 11 + col]
											& bitMov[curBit]) ? BIT1 : 0)
									| ((Testss_bits[88 * row + 2 * 11 + col]
											& bitMov[curBit]) ? BIT2 : 0)
									| ((Testss_bits[88 * row + 3 * 11 + col]
											& bitMov[curBit]) ? BIT3 : 0)
									| ((Testss_bits[88 * row + 4 * 11 + col]
											& bitMov[curBit]) ? BIT4 : 0)
									| ((Testss_bits[88 * row + 5 * 11 + col]
											& bitMov[curBit]) ? BIT5 : 0)
									| ((Testss_bits[88 * row + 6 * 11 + col]
											& bitMov[curBit]) ? BIT6 : 0)
									| ((Testss_bits[88 * row + 7 * 11 + col]
											& bitMov[curBit]) ? BIT7 : 0)),
							SEND_CHR);

				}
			}
		}

		/*
		 while (row < 6) {
		 col = 0;
		 while (col < 84) {
		 LCDSend(
		 (         (Testss_bits[row*8*11 + 0 * 11 + col] & BIT0)
		 | (Testss_bits[row*8*11 + 1 * 11 + col] & BIT1)
		 | (Testss_bits[row*8*11 + 2 * 11 + col] & BIT2)
		 | (Testss_bits[row*8*11 + 3 * 11 + col] & BIT3)
		 | (Testss_bits[row*8*11 + 4 * 11 + col] & BIT4)
		 | (Testss_bits[row*8*11 + 5 * 11 + col] & BIT5)
		 | (Testss_bits[row*8*11 + 6 * 11 + col] & BIT6)
		 | (Testss_bits[row*8*11 + 7 * 11 + col] & BIT7)
		 ),
		 SEND_CHR);

		 col++;
		 }
		 //	LCDSend(0, SEND_CHR);
		 //	LCDSend(0, SEND_CHR);
		 //	LCDSend(0, SEND_CHR);
		 //	LCDSend(0, SEND_CHR);
		 row++;
		 }
		 */
	}
}
